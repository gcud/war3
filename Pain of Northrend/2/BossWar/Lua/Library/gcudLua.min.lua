gcudLua={Version="20200426",Degtorad=0.01745329251994329576,LeftX=0,RightX=0,DownY=0,UpY=0,MAP_AREA=nil,MonsterPlayer=Player(PLAYER_NEUTRAL_AGGRESSIVE),NeutralPlayer=Player(PLAYER_NEUTRAL_PASSIVE),Alliances={},Players={},HumanPlayers={},AiPlayers={},CommandIds={},PlayerColors={"ff0000","0000ff","00ffff","800080","ffff00","ffa500","00ff00","ffc0cb","808080","87cefa","006400","a52a2a"}}gcudLua.RegitserGlobal=function()for a,b in pairs(gcudLua)do _G[a]=b end end;gcudLua.Init=function()gcudLua.Init=nil;gcudLua.LeftX=GetCameraBoundMinX()-GetCameraMargin(CAMERA_MARGIN_LEFT)gcudLua.RightX=GetCameraBoundMaxX()+GetCameraMargin(CAMERA_MARGIN_RIGHT)gcudLua.DownY=GetCameraBoundMinY()-GetCameraMargin(CAMERA_MARGIN_BOTTOM)gcudLua.UpY=GetCameraBoundMaxY()+GetCameraMargin(CAMERA_MARGIN_TOP)gcudLua.MAP_AREA=Rect(gcudLua.LeftX,gcudLua.DownY,gcudLua.RightX,gcudLua.UpY)gcudLua.CommandIds.Move=OrderId("move")gcudLua.CommandIds.Smart=OrderId("smart")gcudLua.CommandIds.Attack=OrderId("attack")for c=1,GetBJMaxPlayers()do local d=Player(c-1)if GetPlayerSlotState(d)==PLAYER_SLOT_STATE_PLAYING then table.insert(gcudLua.Players,d)if GetPlayerController(d)==MAP_CONTROL_COMPUTER then table.insert(gcudLua.AiPlayers,d)else table.insert(gcudLua.HumanPlayers,d)end end end;local e={}for c=1,#gcudLua.Players do table.insert(e,gcudLua.Players[c])end;while#e>0 do local f={}local g=e[1]table.remove(e,1)table.insert(f,g)local h=0;for c=1,#e do if#e>0 then local d=e[c-h]if IsPlayerAlly(d,g)then table.remove(e,c-h)table.insert(f,d)h=h+1 end else break end end;table.insert(gcudLua.Alliances,f)end end;gcudLua.Log=function(i)Preload(i)PreloadGenEnd('MapLog.txt')end;gcudLua.DebugMessage=function(j,...)local k={...}local l=''if#k>0 then l='['..k[1]..']'end;if j==true then j='true'elseif j==false then j='false'elseif j==nil then j='nil'end;print('|cffff0000Debug信息开始|r'..l..j..'|cffff0000Debug信息结束|r')gcudLua.Log(l..j)end;gcudLua.DisplayMessage=function(i,...)local k={...}local d=k[1]if d==nil then d=GetLocalPlayer()end;if k[2]==true then i='|cffff0000'..i..'|r'end;local m=k[3]if m~=nil and m>0 then DisplayTimedTextToPlayer(d,0,0,m,i)else DisplayTextToPlayer(d,0,0,i)end end;gcudLua.IntegerToString=function(n)return('>I4'):pack(n)end;gcudLua.StringToInteger=function(o)local p=('>I4'):unpack(o)return p end;gcudLua.CreateUnitAtCoordinate=function(q,r,s,t)return CreateUnit(q,r,s,t,0)end;gcudLua.UnitHaveSkill=function(u,v)return GetUnitAbilityLevel(u,v)>0 end;gcudLua.UnitIsExist=function(u)return GetUnitState(u,UNIT_STATE_MAX_LIFE)>0 end;gcudLua.IsHero=function(u)return IsUnitType(u,UNIT_TYPE_HERO)end;gcudLua.SetPlayerCameraCoordinate=function(w,s,t)if GetLocalPlayer()==w then SetCameraPosition(s,t)end end;gcudLua.UnitIsAlive=function(u)return GetUnitState(u,UNIT_STATE_LIFE)>0 end;gcudLua.GetUnitMagical=function(u)return GetUnitState(u,UNIT_STATE_MANA)end;gcudLua.GetRandomX=function()return GetRandomReal(gcudLua.LeftX,gcudLua.RightX)end;gcudLua.GetRandomY=function()return GetRandomReal(gcudLua.DownY,gcudLua.UpY)end;gcudLua.CreateUnitAtRandomPosition=function(q,r)return gcudLua.CreateUnitAtCoordinate(q,r,gcudLua.GetRandomX(),gcudLua.GetRandomY())end;gcudLua.GetAngleOffsetXCoordinate=function(x,y,z)return x+math.cos(y*gcudLua.Degtorad)*z end;gcudLua.GetAngleOffsetYCoordinate=function(x,y,z)return x+math.sin(y*gcudLua.Degtorad)*z end;gcudLua.IsAttackDamage=function()return BlzGetEventAttackType()~=ATTACK_TYPE_NORMAL and BlzGetEventDamageType()==DAMAGE_TYPE_NORMAL end;gcudLua.IsPhysicalDamage=function()return BlzGetEventDamageType()==DAMAGE_TYPE_NORMAL end;gcudLua.TimerFunction=function(A,B)local C=CreateTimer()TimerStart(C,A,true,function()B()end)end;gcudLua.TimerFunctionOnce=function(m,B)local C=CreateTimer()TimerStart(C,m,false,function()B()DestroyTimer(C)end)end;gcudLua.gcudFilter=function(D,k)local E=true;for c=1,#D do if E==false then break else local F=D[c]if F=='AliveUnit'then E=E and gcudLua.UnitIsAlive(k.MainUnit)elseif F=='AllianceUnit'then E=E and IsUnitAlly(k.MainUnit,k.MainPlayer)and GetOwningPlayer(k.MainUnit)~=gcudLua.MonsterPlayer elseif F=='EnemyUnit'then E=E and IsUnitEnemy(k.MainUnit,k.MainPlayer)elseif F=='Structure'then E=E and IsUnitType(k.MainUnit,UNIT_TYPE_STRUCTURE)elseif F=='NotStructure'then E=E and not IsUnitType(k.MainUnit,UNIT_TYPE_STRUCTURE)elseif F=='Hero'then E=E and IsUnitType(k.MainUnit,UNIT_TYPE_HERO)elseif F=='NotHero'then E=E and not IsUnitType(k.MainUnit,UNIT_TYPE_HERO)elseif F=='NotMagicImmune'then E=E and not IsUnitType(k.MainUnit,UNIT_TYPE_MAGIC_IMMUNE)elseif F=='Visible'then E=E and IsUnitVisible(k.MainUnit,k.MainPlayer)elseif F=='NotInvulnerable'then E=E and not BlzIsUnitInvulnerable(k.MainUnit)elseif F=='Mechanical'then E=E and IsUnitType(k.MainUnit,UNIT_TYPE_MECHANICAL)elseif F=='NotMechanical'then E=E and not IsUnitType(k.MainUnit,UNIT_TYPE_MECHANICAL)end end end;return E end;gcudLua.InOrderedTable=function(p,G)for c=1,#G do if G[c]~=nil and G[c]==p then return true end end;return false end;gcudLua.OrderTableRemoveItem=function(G,H)for c=1,#G do if G[c]==H then table.remove(G,c)break end end end;gcudLua.EnumUnitsInRangeDoActionAtCoordinate=function(s,t,I,J)local K=CreateGroup()GroupEnumUnitsInRange(K,s,t,I,nil)local L=BlzGroupGetSize(K)if L>0 then for c=1,L do local M=BlzGroupUnitAt(K,0)GroupRemoveUnit(K,M)local N=J(M)if N then break end end end;DestroyGroup(K)end;gcudLua.GetPlayerUnitsCount=function(d)return GetPlayerUnitCount(d)+GetPlayerStructureCount(d,true)end;gcudLua.IsStructure=function(M)return IsUnitType(M,UNIT_TYPE_STRUCTURE)end;gcudLua.GetUnitHP=function(M)return GetUnitState(M,UNIT_STATE_LIFE)end;gcudLua.StringSplit=function(O,P)local Q={}local R=string.len(P)while true do local S,T=string.find(O,P)if S==nil then if O~=''then table.insert(Q,O)end;break else table.insert(Q,string.sub(O,1,S-R))O=string.sub(O,T+R)end end;return Q end;gcudLua.GetPlayerGold=function(d)return GetPlayerState(d,PLAYER_STATE_RESOURCE_GOLD)end;gcudLua.GetPlayerLumber=function(d)return GetPlayerState(d,PLAYER_STATE_RESOURCE_LUMBER)end;gcudLua.GetNowTimeString=function()return os.date('%%Y年%%m月%%d日%%H时%%M分%%S秒')end;gcudLua.GetUnitHPRate=function(M)local U=BlzGetUnitMaxHP(M)if U>0 then return GetUnitState(M,UNIT_STATE_LIFE)/U else return 0 end end;gcudLua.GetUnitMPRate=function(M)local V=BlzGetUnitMaxMana(M)if V>0 then return GetUnitState(M,UNIT_STATE_MANA)/V else return 0 end end;gcudLua.UnitHaveTypeItem=function(M,W)for c=0,5 do local H=UnitItemInSlot(M,c)if H~=nil and GetItemTypeId(H)==W then return true end end;return false end;gcudLua.UnitSkillIsCollDown=function(M,X)return BlzGetUnitAbilityCooldownRemaining(M,X)==0 end;gcudLua.MoveUnitToCoordinate=function(M,s,t)SetUnitX(M,s)SetUnitY(M,t)IssueImmediateOrder(M,'stop')end;gcudLua.GetPlayerColorString=function(Y)if Y<#gcudLua.PlayerColors then return gcudLua.PlayerColors[Y+1]else return gcudLua.PlayerColors[1]end end;gcudLua.InventoryAddItemAble=function(M)for c=0,5 do if UnitItemInSlot(M,c)==nil then return true end end;return false end;gcudLua.ModifyUnitArmor=function(u,p,Z)local _=BlzGetUnitArmor(u)if Z then BlzSetUnitArmor(u,_+p)else BlzSetUnitArmor(u,_-p)end end;gcudLua.ModifyUnitHP=function(u,p,Z)local a0=GetUnitState(u,UNIT_STATE_LIFE)if Z then SetUnitState(u,UNIT_STATE_LIFE,a0+p)else SetUnitState(u,UNIT_STATE_LIFE,a0-p)end end;gcudLua.ModifyUnitMagical=function(u,p,Z)local a1=gcudLua.GetUnitMagical(u)if Z then SetUnitState(u,UNIT_STATE_MANA,a1+p)else SetUnitState(u,UNIT_STATE_MANA,a1-p)end end;gcudLua.ModifyUnitMaxHP=function(u,p,Z)local U=BlzGetUnitMaxHP(u)if Z then BlzSetUnitMaxHP(u,U+p)else BlzSetUnitMaxHP(u,U-p)end end;gcudLua.ModifyUnitAttackPower=function(u,p,Z)local a2,a3=BlzGetUnitBaseDamage(u,0),BlzGetUnitBaseDamage(u,1)if Z then BlzSetUnitBaseDamage(u,a2+p,0)BlzSetUnitBaseDamage(u,a3+p,1)else BlzSetUnitBaseDamage(u,a2-p,0)BlzSetUnitBaseDamage(u,a3-p,1)end end;gcudLua.ModifyHeroStrength=function(a4,p,Z)local a5=GetHeroStr(a4,false)if Z then SetHeroStr(a4,a5+p)else SetHeroStr(a4,a5-p)end end;gcudLua.ModifyHeroAgile=function(a4,p,Z)local a6=GetHeroAgi(a4,false)if Z then SetHeroAgi(a4,a6+p)else SetHeroAgi(a4,a6-p)end end;gcudLua.ModifyHeroIntelligence=function(a4,p,Z)local a7=GetHeroInt(a4,false)if Z then SetHeroInt(a4,a7+p)else SetHeroInt(a4,a7-p)end end;gcudLua.ModifyPlayerGold=function(w,p,Z)local a8=GetPlayerState(w,PLAYER_STATE_RESOURCE_GOLD)if Z then SetPlayerState(w,PLAYER_STATE_RESOURCE_GOLD,a8+p)else SetPlayerState(w,PLAYER_STATE_RESOURCE_GOLD,a8-p)end end;gcudLua.ModifyPlayerLumber=function(w,p,Z)local a8=GetPlayerState(w,PLAYER_STATE_RESOURCE_LUMBER)if Z then SetPlayerState(w,PLAYER_STATE_RESOURCE_LUMBER,a8+p)else SetPlayerState(w,PLAYER_STATE_RESOURCE_LUMBER,a8-p)end end;gcudLua.ModifyUnitHpRecovery=function(u,p,Z)local a9=BlzGetUnitRealField(u,UNIT_RF_HIT_POINTS_REGENERATION_RATE)if Z then BlzSetUnitRealField(u,UNIT_RF_HIT_POINTS_REGENERATION_RATE,a9+p)else BlzSetUnitRealField(u,UNIT_RF_HIT_POINTS_REGENERATION_RATE,a9-p)end end