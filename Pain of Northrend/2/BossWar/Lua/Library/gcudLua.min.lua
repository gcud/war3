gcudLua={Version="20200414",Degtorad=0.01745329251994329576,LeftX=0,RightX=0,DownY=0,UpY=0,MAP_AREA=nil,MonsterPlayer=Player(PLAYER_NEUTRAL_AGGRESSIVE),NeutralPlayer=Player(PLAYER_NEUTRAL_PASSIVE),Alliances={},Players={},HumanPlayers={},AiPlayers={},CommandIds={},PlayerColors={"ff0000","0000ff","00ffff","800080","ffff00","ffa500","00ff00","ffc0cb","808080","87cefa","006400","a52a2a"}}gcudLua.ModifyUnitArmor=function(a,b,c)local d=BlzGetUnitArmor(a)if c then BlzSetUnitArmor(a,d+b)else BlzSetUnitArmor(a,d-b)end end;gcudLua.ModifyUnitHP=function(a,b,c)local e=GetUnitState(a,UNIT_STATE_LIFE)if c then SetUnitState(a,UNIT_STATE_LIFE,e+b)else SetUnitState(a,UNIT_STATE_LIFE,e-b)end end;gcudLua.ModifyUnitMagical=function(a,b,c)local f=gcudLua.GetUnitMagical(a)if c then SetUnitState(a,UNIT_STATE_MANA,f+b)else SetUnitState(a,UNIT_STATE_MANA,f-b)end end;gcudLua.ModifyUnitMaxHP=function(a,b,c)local g=BlzGetUnitMaxHP(a)if c then BlzSetUnitMaxHP(a,g+b)else BlzSetUnitMaxHP(a,g-b)end end;gcudLua.ModifyUnitAttackPower=function(a,b,c)local h,i=BlzGetUnitBaseDamage(a,0),BlzGetUnitBaseDamage(a,1)if c then BlzSetUnitBaseDamage(a,h+b,0)BlzSetUnitBaseDamage(a,i+b,1)else BlzSetUnitBaseDamage(a,h-b,0)BlzSetUnitBaseDamage(a,i-b,1)end end;gcudLua.ModifyHeroStrength=function(j,b,c)local k=GetHeroStr(j,false)if c then SetHeroStr(j,k+b)else SetHeroStr(j,k-b)end end;gcudLua.ModifyHeroAgile=function(j,b,c)local l=GetHeroAgi(j,false)if c then SetHeroAgi(j,l+b)else SetHeroAgi(j,l-b)end end;gcudLua.ModifyHeroIntelligence=function(j,b,c)local m=GetHeroInt(j,false)if c then SetHeroInt(j,m+b)else SetHeroInt(j,m-b)end end;gcudLua.ModifyPlayerGold=function(n,b,c)local o=GetPlayerState(n,PLAYER_STATE_RESOURCE_GOLD)if c then SetPlayerState(n,PLAYER_STATE_RESOURCE_GOLD,o+b)else SetPlayerState(n,PLAYER_STATE_RESOURCE_GOLD,o-b)end end;gcudLua.ModifyPlayerLumber=function(n,b,c)local o=GetPlayerState(n,PLAYER_STATE_RESOURCE_LUMBER)if c then SetPlayerState(n,PLAYER_STATE_RESOURCE_LUMBER,o+b)else SetPlayerState(n,PLAYER_STATE_RESOURCE_LUMBER,o-b)end end;gcudLua.RegitserGlobal=function()for p,q in pairs(gcudLua)do _G[p]=q end end;gcudLua.Init=function()gcudLua.Init=nil;gcudLua.LeftX=GetCameraBoundMinX()-GetCameraMargin(CAMERA_MARGIN_LEFT)gcudLua.RightX=GetCameraBoundMaxX()+GetCameraMargin(CAMERA_MARGIN_RIGHT)gcudLua.DownY=GetCameraBoundMinY()-GetCameraMargin(CAMERA_MARGIN_BOTTOM)gcudLua.UpY=GetCameraBoundMaxY()+GetCameraMargin(CAMERA_MARGIN_TOP)gcudLua.MAP_AREA=Rect(gcudLua.LeftX,gcudLua.DownY,gcudLua.RightX,gcudLua.UpY)gcudLua.CommandIds.Move=OrderId("move")gcudLua.CommandIds.Smart=OrderId("smart")gcudLua.CommandIds.Attack=OrderId("attack")for r=1,GetBJMaxPlayers()do local s=Player(r-1)if GetPlayerSlotState(s)==PLAYER_SLOT_STATE_PLAYING then table.insert(gcudLua.Players,s)if GetPlayerController(s)==MAP_CONTROL_COMPUTER then table.insert(gcudLua.AiPlayers,s)else table.insert(gcudLua.HumanPlayers,s)end end end;local t={}for r=1,#gcudLua.Players do table.insert(t,gcudLua.Players[r])end;while#t>0 do local u={}local v=t[1]table.remove(t,1)table.insert(u,v)local w=0;for r=1,#t do if#t>0 then local s=t[r-w]if IsPlayerAlly(s,v)then table.remove(t,r-w)table.insert(u,s)w=w+1 end else break end end;table.insert(gcudLua.Alliances,u)end end;gcudLua.Log=function(x)Preload(x)PreloadGenEnd('MapLog.txt')end;gcudLua.DebugMessage=function(y,...)local z={...}local A=''if#z>0 then A='['..z[1]..']'end;if y==true then y='true'elseif y==false then y='false'elseif y==nil then y='nil'end;print('|cffff0000Debug信息开始|r'..A..y..'|cffff0000Debug信息结束|r')gcudLua.Log(A..y)end;gcudLua.DisplayMessage=function(x,...)local z={...}local s=z[1]if s==nil then s=GetLocalPlayer()end;if z[2]==true then x='|cffff0000'..x..'|r'end;local B=z[3]if B~=nil and B>0 then DisplayTimedTextToPlayer(s,0,0,B,x)else DisplayTextToPlayer(s,0,0,x)end end;gcudLua.IntegerToString=function(C)return('>I4'):pack(C)end;gcudLua.StringToInteger=function(D)local b=('>I4'):unpack(D)return b end;gcudLua.CreateUnitAtCoordinate=function(E,F,G,H)return CreateUnit(E,F,G,H,0)end;gcudLua.UnitHaveSkill=function(a,I)return GetUnitAbilityLevel(a,I)>0 end;gcudLua.UnitIsExist=function(a)return GetUnitState(a,UNIT_STATE_MAX_LIFE)>0 end;gcudLua.IsHero=function(a)return IsUnitType(a,UNIT_TYPE_HERO)end;gcudLua.SetPlayerCameraCoordinate=function(n,G,H)if GetLocalPlayer()==n then SetCameraPosition(G,H)end end;gcudLua.UnitIsAlive=function(a)return GetUnitState(a,UNIT_STATE_LIFE)>0 end;gcudLua.GetUnitMagical=function(a)return GetUnitState(a,UNIT_STATE_MANA)end;gcudLua.GetRandomX=function()return GetRandomReal(gcudLua.LeftX,gcudLua.RightX)end;gcudLua.GetRandomY=function()return GetRandomReal(gcudLua.DownY,gcudLua.UpY)end;gcudLua.CreateUnitAtRandomPosition=function(E,F)return gcudLua.CreateUnitAtCoordinate(E,F,gcudLua.GetRandomX(),gcudLua.GetRandomY())end;gcudLua.GetAngleOffsetXCoordinate=function(J,K,L)return J+math.cos(K*gcudLua.Degtorad)*L end;gcudLua.GetAngleOffsetYCoordinate=function(J,K,L)return J+math.sin(K*gcudLua.Degtorad)*L end;gcudLua.IsAttackDamage=function()return BlzGetEventAttackType()~=ATTACK_TYPE_NORMAL and BlzGetEventDamageType()==DAMAGE_TYPE_NORMAL end;gcudLua.IsPhysicalDamage=function()return BlzGetEventDamageType()==DAMAGE_TYPE_NORMAL end;gcudLua.TimerFunction=function(M,N)local O=CreateTimer()TimerStart(O,M,true,function()N()end)end;gcudLua.TimerFunctionOnce=function(B,N)local O=CreateTimer()TimerStart(O,B,false,function()N()DestroyTimer(O)end)end;gcudLua.gcudFilter=function(P,z)local Q=true;for r=1,#P do if Q==false then break else local R=P[r]if R=='AliveUnit'then Q=Q and gcudLua.UnitIsAlive(z.MainUnit)elseif R=='AllianceUnit'then Q=Q and IsUnitAlly(z.MainUnit,z.MainPlayer)and GetOwningPlayer(z.MainUnit)~=gcudLua.MonsterPlayer elseif R=='EnemyUnit'then Q=Q and IsUnitEnemy(z.MainUnit,z.MainPlayer)elseif R=='Structure'then Q=Q and IsUnitType(z.MainUnit,UNIT_TYPE_STRUCTURE)elseif R=='NotStructure'then Q=Q and not IsUnitType(z.MainUnit,UNIT_TYPE_STRUCTURE)elseif R=='Hero'then Q=Q and IsUnitType(z.MainUnit,UNIT_TYPE_HERO)elseif R=='NotHero'then Q=Q and not IsUnitType(z.MainUnit,UNIT_TYPE_HERO)elseif R=='NotMagicImmune'then Q=Q and not IsUnitType(z.MainUnit,UNIT_TYPE_MAGIC_IMMUNE)elseif R=='Visible'then Q=Q and IsUnitVisible(z.MainUnit,z.MainPlayer)elseif R=='NotInvulnerable'then Q=Q and not BlzIsUnitInvulnerable(z.MainUnit)end end end;return Q end;gcudLua.InOrderedTable=function(b,S)for r=1,#S do if S[r]~=nil and S[r]==b then return true end end;return false end;gcudLua.OrderTableRemoveItem=function(S,T)for r=1,#S do if S[r]==T then table.remove(S,r)break end end end;gcudLua.EnumUnitsInRangeDoActionAtCoordinate=function(G,H,U,V)local W=CreateGroup()GroupEnumUnitsInRange(W,G,H,U,nil)local X=BlzGroupGetSize(W)if X>0 then for r=1,X do local Y=BlzGroupUnitAt(W,0)GroupRemoveUnit(W,Y)local Z=V(Y)if Z then break end end end;DestroyGroup(W)end;gcudLua.GetPlayerUnitsCount=function(s)return GetPlayerUnitCount(s)+GetPlayerStructureCount(s,true)end;gcudLua.IsStructure=function(Y)return IsUnitType(Y,UNIT_TYPE_STRUCTURE)end;gcudLua.GetUnitHP=function(Y)return GetUnitState(Y,UNIT_STATE_LIFE)end;gcudLua.StringSplit=function(_,a0)local a1={}local a2=string.len(a0)while true do local a3,a4=string.find(_,a0)if a3==nil then if _~=''then table.insert(a1,_)end;break else table.insert(a1,string.sub(_,1,a3-a2))_=string.sub(_,a4+a2)end end;return a1 end;gcudLua.GetPlayerGold=function(s)return GetPlayerState(s,PLAYER_STATE_RESOURCE_GOLD)end;gcudLua.GetPlayerLumber=function(s)return GetPlayerState(s,PLAYER_STATE_RESOURCE_LUMBER)end;gcudLua.GetNowTimeString=function()return os.date('%%Y年%%m月%%d日%%H时%%M分%%S秒')end;gcudLua.GetUnitHPRate=function(Y)local g=BlzGetUnitMaxHP(Y)if g>0 then return GetUnitState(Y,UNIT_STATE_LIFE)/g else return 0 end end;gcudLua.GetUnitMPRate=function(Y)local a5=BlzGetUnitMaxMana(Y)if a5>0 then return GetUnitState(Y,UNIT_STATE_MANA)/a5 else return 0 end end;gcudLua.UnitHaveTypeItem=function(Y,a6)for r=0,5 do local T=UnitItemInSlot(Y,r)if T~=nil and GetItemTypeId(T)==a6 then return true end end;return false end;gcudLua.UnitSkillIsCollDown=function(Y,a7)return BlzGetUnitAbilityCooldownRemaining(Y,a7)==0 end;gcudLua.MoveUnitToCoordinate=function(Y,G,H)SetUnitX(Y,G)SetUnitY(Y,H)IssueImmediateOrder(Y,'stop')end;gcudLua.GetPlayerColorString=function(a8)if a8<#gcudLua.PlayerColors then return gcudLua.PlayerColors[a8+1]else return gcudLua.PlayerColors[1]end end;gcudLua.InventoryAddItemAble=function(Y)for r=0,5 do if UnitItemInSlot(Y,r)==nil then return true end end;return false end